<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DebateCoach - Practice Debate with AI</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <div class="logo-section">
        <div class="logo"><img src="debate_logo.png" alt="DebateCoach Logo" /></div>
        <div>
          <div class="title">DebateCoach</div>
          <div class="subtitle">Practice debate with AI â€¢ Improve your English</div>
        </div>
      </div>
      <div class="timer-section">
        <button class="btn btn-secondary" id="settingsBtn">âš™ï¸ Settings</button>
        <button class="btn btn-danger hidden" id="stopResetBtn">ğŸ›‘ Stop & Reset</button>
        <div id="timerSection" class="hidden">
          <div class="timer-display" id="timerDisplay">5:00</div>
        </div>
      </div>
    </div>

    <!-- NEW WELCOME SECTION WITH TOPIC -->
    <div id="welcomeSection">
      <div class="welcome-card">
        <div class="welcome-logo">
          <img src="debate_logo.png" alt="DebateCoach Logo" />
        </div>
        <h1 class="welcome-title">Welcome to DebateCoach</h1>
        <p class="welcome-subtitle">
          Practice debate with AI and improve your English speaking skills
        </p>

        <!-- TOPIC SELECTOR (SIMPLIFIED!) -->
        <div class="topic-selector">
          <div class="topic-label">ğŸ² Today's Topic</div>
          
          <!-- CATEGORY SELECTOR -->
          <div class="category-selector">
            <label for="categorySelect" class="category-label">ğŸ“š Category:</label>
            <select class="form-select category-dropdown" id="categorySelect">
              <option value="all">All Topics (110+)</option>
              <option value="society">Society & Politics</option>
              <option value="technology">Technology & AI</option>
              <option value="education">Education</option>
              <option value="environment">Environment & Climate</option>
              <option value="economics">Economics & Business</option>
              <option value="health">Health & Science</option>
              <option value="culture">Culture & Media</option>
            </select>
          </div>
          
          <!-- EDITABLE TOPIC DISPLAY (click to edit) -->
          <div class="topic-display editable" id="mainTopicDisplay" contenteditable="true" spellcheck="false">Loading topic...</div>
          <div class="topic-hint">ğŸ’¡ Click topic to edit directly</div>
          
          <!-- SIMPLIFIED ACTIONS: Only 2 buttons -->
          <div class="topic-actions">
            <button class="btn btn-outline" id="newTopicBtn">ğŸ² Random Topic</button>
            <button class="btn btn-outline btn-ai" id="aiTopicBtn">ğŸ¤– AI Topic</button>
          </div>
        </div>

        <!-- START BUTTON (ALWAYS VISIBLE) -->
        <button class="btn btn-primary btn-large" id="startDebateBtn">â–¶ï¸ Start Debate</button>

       <!-- QUICK TIPS -->
        <div class="quick-tips">
          <div class="tip">ğŸ’¡ Use Safari for best voice experience</div>
          <div class="tip">âš™ï¸ Customize settings before you start</div>
        </div>
        
        <!-- Hidden input for flow.js compatibility -->
        <input type="text" id="topicInput" style="display: none;" />
      </div>
    </div>

    <!-- DEBATE TOPIC DISPLAY (shown during debate) -->
    <div id="debateTopicDisplay" class="debate-topic hidden">
      <div class="debate-topic-label">ğŸ¯ Debate Motion</div>
      <div class="debate-topic-text" id="currentTopicText"></div>
    </div>

    <!-- LOADING STATE -->
    <div id="loadingState" class="loading-state hidden">
      <div class="loading-spinner"></div>
      <div class="loading-text">ğŸ¤” Thinking...</div>
      <div class="loading-subtext">Analyzing your argument...</div>
    </div>

    <!-- DEBATE CONVERSATION -->
    <div id="conversationSection" class="debate-conversation hidden"></div>

    <!-- ACTION BUTTONS (shown during debate / end) -->
    <div id="resetSection" class="hidden" style="text-align: center; margin-top: 16px;">
      <button class="btn btn-warning" id="resetBtn">ğŸ”„ Reset Session</button>
      <button class="btn btn-danger" id="endDebateBtn">ğŸ End Debate & Get Feedback</button>
      <button class="btn btn-primary hidden" id="switchSidesBtn">ğŸ” Switch Sides</button>
    </div>

    <!-- INPUT SECTION (shown when it's student's turn) -->
    <div id="inputSection" class="input-section hidden">
      <div class="card-title">âœï¸ Your Turn</div>

      <div class="input-controls">
        <button class="btn btn-danger" id="recordBtn">ğŸ¤ Record</button>
        <button class="btn btn-secondary" id="stopRecordBtn" disabled>â¹ï¸ Stop</button>
        <button class="btn btn-info" id="typeBtn">âŒ¨ï¸ Type Instead</button>
      </div>

      <div class="transcript-display empty" id="transcriptDisplay">Your transcript will appear here...</div>

      <textarea class="textarea hidden" id="manualInput" placeholder="Type your argument here... (Press Enter to send, Ctrl+Enter for new line)"></textarea>

      <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
        <button class="btn btn-success" id="sendBtn" style="flex: 1;">ğŸ“¤ Send (Enter)</button>
        <button class="btn btn-danger" id="endSessionBtn">ğŸ End Session</button>
      </div>

      <div class="keyboard-hint">ğŸ’¡ Press <kbd>Enter</kbd> to send â€¢ <kbd>Ctrl+Enter</kbd> for new line â€¢ <kbd>Esc</kbd> to stop speaking</div>
    </div>

    <!-- FEEDBACK SECTION (shown after user requests feedback) -->
    <div id="feedbackSection" class="card hidden" style="margin-top: 16px;">
      <div class="card-title">ğŸ“ Teacher's Feedback</div>

      <div class="feedback-tabs">
        <button class="tab active" data-mode="short">ğŸ“ Quick Summary</button>
        <button class="tab" data-mode="detailed">ğŸ“š Detailed Analysis</button>
      </div>

      <div class="feedback-content" id="feedbackContent">Click a tab to generate feedback...</div>

      <!-- STATS SUMMARY (NEW!) -->
      <div id="statsSection" class="stats-section hidden">
        <h3 class="stats-title">ğŸ“Š Session Stats</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Arguments</div>
            <div class="stat-value" id="statArguments">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Avg Length</div>
            <div class="stat-value" id="statAvgLength">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Duration</div>
            <div class="stat-value" id="statDuration">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Difficulty</div>
            <div class="stat-value" id="statDifficulty">-</div>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
        <button class="btn btn-primary" id="downloadFeedbackBtn">ğŸ’¾ Save Report</button>
        <button class="btn btn-secondary" id="printFeedbackBtn">ğŸ–¨ï¸ Print</button>
        <button class="btn btn-success" id="newSessionBtn">ğŸ”„ New Debate</button>
      </div>
    </div>

    <!-- CONTINUE DEBATE PROMPT (NEW!) -->
    <div id="continuePrompt" class="continue-prompt hidden">
      <div class="continue-card">
        <h3>âœ… Session Complete!</h3>
        <p>You've completed 6 turns. Would you like to continue debating or get feedback?</p>
        <div class="continue-actions">
          <button class="btn btn-success" id="continueMoreBtn">â–¶ï¸ Continue Debating</button>
          <button class="btn btn-primary" id="getFeedbackBtn">ğŸ“Š View Feedback</button>
          <button class="btn btn-secondary" id="newTopicBtn2">ğŸ”„ New Topic</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">âš™ï¸ Settings</div>
        <button class="close-modal" id="closeModalBtn">Ã—</button>
      </div>

      <div class="accordion">
        <!-- 1) Setup -->
        <div class="acc-item open" id="accItemSetup">
          <button type="button" class="acc-header" data-acc="accSetup">
            <span>ğŸ¯ Setup</span>
            <span class="acc-chevron">â–¾</span>
          </button>

          <div class="acc-body" id="accSetup">
            <div class="settings-row">
              <div class="form-group">
                <label class="form-label">Your Side</label>
                <select class="form-select" id="stanceSelect">
                  <option value="PRO">PRO (For) â­ PRO starts first</option>
                  <option value="CON">CON (Against)</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Difficulty</label>
                <select class="form-select" id="difficultySelect">
                  <option value="Easy">Easy</option>
                  <option value="Medium" selected>Medium</option>
                  <option value="Hard">Hard</option>
                </select>
              </div>
            </div>

            <div class="settings-row" style="margin-top: 14px;">
              <div class="form-group">
                <label class="form-label">Mode</label>
                <select class="form-select" id="modeSelect">
                  <option value="practice">ğŸ’ª Practice (No time limit)</option>
                  <option value="competition">ğŸ¯ Competition</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Minutes per turn (Competition)</label>
                <div class="minutes-radio" id="minutesRadio">
                  <label><input type="radio" name="turnMinutes" value="1"> 1</label>
                  <label><input type="radio" name="turnMinutes" value="2"> 2</label>
                  <label><input type="radio" name="turnMinutes" value="3"> 3</label>
                  <label><input type="radio" name="turnMinutes" value="4"> 4</label>
                  <label><input type="radio" name="turnMinutes" value="5" checked> 5</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 2) Voice -->
        <div class="acc-item">
          <button type="button" class="acc-header" data-acc="accVoice">
            <span>ğŸ”Š Voice</span>
            <span class="acc-chevron">â–¾</span>
          </button>

          <div class="acc-body hidden" id="accVoice">
            <div class="settings-row">
              <div class="form-group">
                <label class="form-label">Auto-speak computer replies</label>
                <select class="form-select" id="autoSpeakSelect">
                  <option value="true" selected>On</option>
                  <option value="false">Off</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Voice</label>
                <select class="form-select" id="voiceSelect">
                  <option value="">(System Default)</option>
                </select>
              </div>
            </div>

            <div style="display:flex; gap:12px; margin-top: 12px; flex-wrap: wrap;">
              <button class="btn btn-secondary" id="testVoiceBtn">ğŸ”Š Test voice</button>
              <button class="btn btn-secondary" id="stopSpeakingBtn">ğŸ”‡ Stop Speaking</button>
            </div>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap;">
        <button class="btn btn-secondary" id="closeSettingsBtn" style="flex: 1;">Done</button>
      </div>
    </div>
  </div>

  <!-- ERROR MODAL (NEW!) -->
  <div class="error-overlay hidden" id="errorOverlay">
    <div class="error-modal">
      <div class="error-icon">âš ï¸</div>
      <div class="error-title" id="errorTitle">Error</div>
      <div class="error-message" id="errorMessage">Something went wrong</div>
      <div class="error-actions">
        <button class="btn btn-primary" id="errorRetryBtn">ğŸ”„ Retry</button>
        <button class="btn btn-secondary" id="errorCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast">
    <span id="toastMessage"></span>
  </div>

  <script type="module" src="/js/main.js"></script>
</body>
</html>
