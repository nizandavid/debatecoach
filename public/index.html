<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DebateCoach - Practice Debate with AI</title>
  <link rel="stylesheet" href="/styles.css?v=3" />
 
<style>
/* DEBATE SCREEN OVERRIDES */
.stop-reset-btn, #stopResetBtn { display: none !important; }
#downloadTranscriptBtn.hidden { display: none !important; }

/* Larger header logo */
.header .logo { width: 70px !important; height: 70px !important; }
.header .logo img { width: 70px !important; height: 70px !important; }

/* Center debate topic */
.debate-topic-display { text-align: center !important; font-size: 20px !important; font-weight: 700 !important; padding: 20px !important; }

/* Center buttons */
.reset-section { display: flex !important; gap: 12px !important; justify-content: center !important; margin: 16px auto !important; }
.reset-section button { min-width: 170px !important; height: 50px !important; }
</style>


  <link rel="stylesheet" href="/new-features.css" />
</head>
<body>
  <div class="container">
    <!-- HEADER (debate mode only - hidden on welcome) -->
    <div class="header hidden" id="debateHeader">
      <div class="logo-section">
        <div class="logo"><img src="debate_logo.png" alt="DebateCoach Logo" /></div>
        <div>
          <div class="title">DebateCoach</div>
        </div>
      </div>
      <div class="timer-section">
<button class="btn btn-secondary btn-sm hidden" id="settingsBtn">âš™ï¸</button>
        <button class="btn btn-danger hidden" id="stopResetBtn">ğŸ›‘ Stop & Reset</button>
        <button class="btn btn-success hidden" id="downloadTranscriptBtn">ğŸ“¥ Download</button>
        <div id="timerSection" class="hidden">
          <div class="timer-display" id="timerDisplay">5:00</div>
        </div>
      </div>
    </div>

    <!-- NEW WELCOME SECTION WITH TOPIC -->
    <div id="welcomeSection">
      <div class="welcome-card">
        <!-- Settings gear button - top right of card -->
        <button class="welcome-settings-btn" id="welcomeSettingsBtn" title="Settings">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </button>
        <div class="welcome-logo">
          <img src="debate_logo.png" alt="DebateCoach Logo" />
        </div>
        <h1 class="welcome-title">Welcome to DebateCoach</h1>
        <p class="welcome-subtitle">
          Practice debate with AI and improve your English speaking skills
        </p>

        <!-- TOPIC SELECTOR (NEW!) -->
        <div class="topic-selector">
          <div class="topic-label">ğŸ² Today's Topic</div>
          
          <!-- CATEGORY SELECTOR (NEW!) -->
          <div class="category-selector">
            <label for="categorySelect" class="category-label">ğŸ“š Category:</label>
            <select class="form-select category-dropdown" id="categorySelect">
              <option value="all">All Topics (110+)</option>
              <option value="society">Society & Politics</option>
              <option value="technology">Technology & AI</option>
              <option value="education">Education</option>
              <option value="environment">Environment & Climate</option>
              <option value="economics">Economics & Business</option>
              <option value="health">Health & Science</option>
              <option value="culture">Culture & Media</option>
            </select>
          </div>
          
          <div class="topic-display" id="mainTopicDisplay" contenteditable="true">Loading topic...</div>
          <div class="topic-actions">
            <button class="btn btn-outline" id="newTopicBtn">ğŸ² Random</button>
            <button class="btn btn-outline btn-ai" id="aiTopicBtn">ğŸ¤– AI Topic</button>
            <button class="btn btn-outline" id="editTopicBtn">ğŸ“ Edit</button>
          </div>
        </div>

        <!-- TOPIC INPUT (HIDDEN BY DEFAULT) -->
        <div class="topic-input-wrapper hidden" id="topicInputWrapper">
          <input type="text" class="topic-input-field" id="mainTopicInput" placeholder="Enter your debate topic..." />
          <div class="topic-input-actions">
            <button class="btn btn-secondary" id="suggestTopicsMainBtn">ğŸ’¡ Suggest Topics</button>
            <button class="btn btn-success" id="saveTopicBtn">âœ“ Save</button>
            <button class="btn btn-secondary" id="cancelTopicBtn">âœ• Cancel</button>
          </div>
          <div id="topicsListWrapperMain" class="hidden">
            <select class="form-select" id="topicsSelectMain" size="6"></select>
          </div>
        </div>

        <!-- MODE PICKER -->
        <div class="mode-picker-section">
          <div class="picker-label">ğŸ¯ Choose Mode</div>
          <div class="mode-picker">
            <button class="mode-btn active" id="modeTrainingBtn" data-mode="training">
              <span class="mode-icon">ğŸ“š</span>
              <span class="mode-name">Training</span>
              <span class="mode-desc">Practice at your own pace</span>
            </button>
            <button class="mode-btn" id="modeCompetitionBtn" data-mode="competition">
              <span class="mode-icon">ğŸ†</span>
              <span class="mode-name">Competition</span>
              <span class="mode-desc">Timed rounds, scored debate</span>
            </button>
          </div>
        </div>

        <!-- STANCE PICKER -->
        <div class="stance-picker-section">
          <div class="picker-label">âš–ï¸ Choose Your Side</div>
          <div class="stance-picker">
            <button class="stance-btn active" id="stanceForBtn" data-stance="PRO">
              <span class="stance-icon">ğŸ‘</span>
              <span class="stance-name">FOR</span>
              <span class="stance-desc">You argue in favor â€¢ You go first</span>
            </button>
            <button class="stance-btn" id="stanceAgainstBtn" data-stance="CON">
              <span class="stance-icon">ğŸ‘</span>
              <span class="stance-name">AGAINST</span>
              <span class="stance-desc">You argue against â€¢ AI goes first</span>
            </button>
          </div>
        </div>

        <!-- START BUTTON (ALWAYS VISIBLE) -->
        <button class="btn btn-primary btn-large" id="startDebateBtn">â–¶ï¸ Start Debate</button>

       <!-- QUICK TIPS -->
        <div class="quick-tips">
          <div class="tip">ğŸ’¡ Use Safari for best voice experience</div>
         <div class="tip"> âš™ï¸ Customize settings before you start</div>
        </div>
        
        <!-- Hidden input for flow.js compatibility -->
        <input type="text" id="topicInput" style="display: none;" />
      </div>
    </div>

    <!-- DEBATE TOPIC DISPLAY (shown during debate) -->
    <div id="debateTopicDisplay" class="debate-topic hidden">
      <div class="debate-topic-label">ğŸ¯ Debate Motion</div>
      <div class="debate-topic-text" id="currentTopicText"></div>
    </div>

    <!-- LOADING STATE -->
    <div id="loadingState" class="loading-state hidden">
      <div class="loading-spinner"></div>
      <div class="loading-text">ğŸ¤” Thinking...</div>
      <div class="loading-subtext">Analyzing your argument...</div>
    </div>

    <!-- DEBATE CONVERSATION -->
    <div id="conversationSection" class="debate-conversation hidden"></div>

    <!-- ACTION BUTTONS (shown during debate / end) -->
   <div id="resetSection" class="hidden" style="text-align: center; margin-top: 16px;">
  <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
    <button class="btn btn-warning" id="resetBtn">ğŸ”„ Reset Session</button>
    <button class="btn" id="finalRoundBtn" style="display: none;">ğŸ Final Round</button>
    <button class="btn btn-danger" id="endDebateBtn">ğŸ End Debate & Get Feedback</button>
  </div>
</div>

  
 <!-- INPUT SECTION (shown when it's student's turn) -->
<div id="inputSection" class="input-section hidden">
  <div class="card-title">âœï¸ Your Turn</div>
  
  <!-- TALKING POINTS SECTION -->
  <div class="talking-points-section">
    <button class="btn btn-info" id="generateTalkingPointsBtn">
      âœ¨ Generate Talking Points
    </button>
    
    <div id="talkingPointsContainer" class="talking-points-container hidden">
      <div class="talking-points-header">
        <h4>ğŸ’¡ Talking Points for Your Side</h4>
        <button class="close-points-btn" id="closeTalkingPointsBtn">âœ•</button>
      </div>
      <div id="talkingPointsContent" class="talking-points-content">
        <!-- AI points appear here -->
      </div>
    </div>
  </div>
  
  <!-- INPUT CONTROLS -->
  <div class="input-controls">
    <button class="btn btn-danger" id="recordBtn">ğŸ¤ Record</button>
    <button class="btn btn-secondary" id="stopRecordBtn" disabled>â¹ï¸ Stop</button>
    <button class="btn btn-info" id="typeBtn">âŒ¨ï¸ Type Instead</button>
  </div>
  
  <div class="transcript-display empty" id="transcriptDisplay">Your transcript will appear here...</div>
  <textarea class="textarea hidden" id="manualInput" placeholder="Type your argument here... (Press Enter to send, Ctrl+Enter for new line)"></textarea>
  
  <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
    <button class="btn btn-success" id="sendBtn" style="flex: 1;">ğŸ“¤ Send (Enter)</button>
    <button class="btn btn-danger" id="endSessionBtn">ğŸ End Session</button>
  </div>
  
  <div class="keyboard-hint">ğŸ’¡ Press <kbd>Enter</kbd> to send â€¢ <kbd>Ctrl+Enter</kbd> for new line â€¢ <kbd>Esc</kbd> to stop speaking</div>
</div>
    <!-- FEEDBACK SECTION (shown after user requests feedback) -->
    <div id="feedbackSection" class="card hidden" style="margin-top: 16px;">
      <div class="card-title">ğŸ“ Teacher's Feedback</div>

      <div class="feedback-tabs">
        <button class="tab active" data-mode="short">ğŸ“ Quick Summary</button>
        <button class="tab" data-mode="detailed">ğŸ“š Detailed Analysis</button>
      </div>

      <div class="feedback-content" id="feedbackContent">Click a tab to generate feedback...</div>

      <!-- STATS SUMMARY (NEW!) -->
      <div id="statsSection" class="stats-section hidden">
        <h3 class="stats-title">ğŸ“Š Session Stats</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Arguments</div>
            <div class="stat-value" id="statArguments">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Avg Length</div>
            <div class="stat-value" id="statAvgLength">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Duration</div>
            <div class="stat-value" id="statDuration">-</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Difficulty</div>
            <div class="stat-value" id="statDifficulty">-</div>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
        <button class="btn btn-primary" id="downloadFeedbackBtn">ğŸ’¾ Save Report</button>
        <button class="btn btn-secondary" id="printFeedbackBtn">ğŸ–¨ï¸ Print</button>
        <button class="btn btn-success" id="newSessionBtn">ğŸ”„ New Debate</button>
      </div>
    </div>

    <!-- CONTINUE DEBATE PROMPT (NEW!) -->
    <div id="continuePrompt" class="continue-prompt hidden">
      <div class="continue-card">
        <h3>âœ… Session Complete!</h3>
        <p>You've completed 6 turns. Would you like to continue debating or get feedback?</p>
        <div class="continue-actions">
          <button class="btn btn-success" id="continueMoreBtn">â–¶ï¸ Continue Debating</button>
          <button class="btn btn-primary" id="getFeedbackBtn">ğŸ“Š View Feedback</button>
          <button class="btn btn-secondary" id="newTopicBtn2">ğŸ”„ New Topic</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL (mode-aware) -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal settings-modal-new">
      <button class="close-modal" id="closeModalBtn">Ã—</button>
      <div class="modal-header">
        <div class="modal-title">
          âš™ï¸ Settings
          <span class="settings-mode-badge training" id="settingsModeBadge">ğŸ“š Training</span>
        </div>
      </div>

      <div class="settings-body-scroll">

        <!-- TRAINING SECTIONS -->
<div class="settings-sections-training">
  
  <!-- 1. AI DIFFICULTY - FIRST -->
  <div class="settings-section">
    <div class="settings-section-title">ğŸ¤– AI Opponent</div>
    <div class="diff-grid">
      <button class="diff-card" data-level="Easy" id="easyBtn">
        <span class="diff-icon">ğŸ˜Š</span>
        <span class="diff-name">Easy</span>
        <span class="diff-desc">Simple, supportive</span>
      </button>
      <button class="diff-card active" data-level="Medium" id="mediumBtn">
        <span class="diff-icon">ğŸ§ </span>
        <span class="diff-name">Medium</span>
        <span class="diff-desc">Balanced challenge</span>
      </button>
      <button class="diff-card" data-level="Hard" id="hardBtn">
        <span class="diff-icon">ğŸ”¥</span>
        <span class="diff-name">Hard</span>
        <span class="diff-desc">No mercy</span>
      </button>
    </div>
  </div>

  <!-- 2. SESSION END OPTIONS -->
  <div class="settings-section">
    <div class="settings-section-title">ğŸ”š Session End Options</div>
    <div class="settings-toggle-row">
      <label class="form-label">Show "Final Round" button during debate</label>
      <label class="toggle-switch">
        <input type="checkbox" id="finalRoundToggle" checked>
        <span class="toggle-slider"></span>
      </label>
    </div>
    <p class="settings-hint">When clicked, both sides give one closing summary argument, then session ends.</p>
    <div class="settings-toggle-row" style="margin-top:12px;">
      <label class="form-label">Show AI feedback summary at end</label>
      <label class="toggle-switch">
        <input type="checkbox" id="feedbackToggle" checked>
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <!-- 3. SOUND & VOICE - LAST -->
  <div class="settings-section">
    <div class="settings-section-title">ğŸ¤ Sound & Voice</div>
    <div class="settings-row">
      <div class="form-group">
        <label class="form-label">Auto-speak AI responses</label>
        <select class="form-select" id="autoSpeakSelect">
          <option value="true" selected>On</option>
          <option value="false">Off</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Voice</label>
        <select class="form-select" id="voiceSelect">
          <option value="">(System Default)</option>
        </select>
      </div>
    </div>
    <div style="display:flex; gap:12px; margin-top:12px; flex-wrap:wrap;">
      <button class="btn btn-secondary" id="testVoiceBtn">ğŸ”Š Test voice</button>
      <button class="btn btn-secondary" id="stopSpeakingBtn">ğŸ”‡ Stop Speaking</button>
    </div>
  </div>
  
</div>

        <!-- COMPETITION SECTIONS -->
        <div class="settings-sections-competition" style="display:none">
          <div class="settings-section">
            <div class="settings-section-title">ğŸ† Competition Rules</div>
            <div class="settings-info-box competition">
              <strong>Format:</strong> Each side gives timed arguments. The <strong>3rd argument</strong> is a closing summary â€” no new points. Debate ends automatically.
            </div>
            <div class="form-group" style="margin-bottom:16px;">
              <label class="form-label">
                Time per Argument
                <span class="settings-value-badge" id="argTimeDisplay">90 sec</span>
              </label>
              <div class="slider-row">
                <span class="slider-label">30s</span>
                <input type="range" id="argTimeSlider" class="settings-slider" min="30" max="300" step="15" value="90">
                <span class="slider-label">5 min</span>
              </div>
            </div>
            <div class="form-group" style="margin-bottom:16px;">
              <label class="form-label">
                Warning at
                <span class="settings-value-badge" id="warnTimeDisplay">15s left</span>
              </label>
              <div class="slider-row">
                <span class="slider-label">5s</span>
                <input type="range" id="warnTimeSlider" class="settings-slider" min="5" max="60" step="5" value="15">
                <span class="slider-label">60s</span>
              </div>
            </div>
            <div class="settings-toggle-row">
              <label class="form-label">Timer warning sound</label>
              <label class="toggle-switch">
                <input type="checkbox" id="timerSoundToggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="settings-toggle-row" style="margin-top:10px;">
              <label class="form-label">Strict mode â€” mic cuts off when time expires</label>
              <label class="toggle-switch">
                <input type="checkbox" id="strictModeToggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">ğŸ¤ Voice</div>
            <div class="settings-row">
              <div class="form-group">
                <label class="form-label">Auto-speak AI responses</label>
                <select class="form-select" id="autoSpeakSelectC">
                  <option value="true" selected>On</option>
                  <option value="false">Off</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Voice</label>
                <select class="form-select" id="voiceSelectC">
                  <option value="">(System Default)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">â­ Scoring &amp; Feedback</div>
            <div class="settings-toggle-row">
              <label class="form-label">Show score after each argument</label>
              <label class="toggle-switch">
                <input type="checkbox" id="showScoreToggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="settings-toggle-row" style="margin-top:10px;">
              <label class="form-label">Final verdict + winner declared at end</label>
              <label class="toggle-switch">
                <input type="checkbox" id="verdictToggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>


          <!-- Hidden selects for flow.js compatibility -->
          <select id="difficultySelect" style="display:none;">
            <option value="Easy">Easy</option>
            <option value="Medium" selected>Medium</option>
            <option value="Hard">Hard</option>
          </select>
          <select id="stanceSelect" style="display:none;">
            <option value="PRO">PRO</option>
            <option value="CON">CON</option>
          </select>
          <select id="modeSelect" style="display:none;">
            <option value="practice">practice</option>
            <option value="competition">competition</option>
          </select>
          <div id="minutesRadio" style="display:none;">
            <label><input type="radio" name="turnMinutes" value="1"> 1</label>
            <label><input type="radio" name="turnMinutes" value="2"> 2</label>
            <label><input type="radio" name="turnMinutes" value="3"> 3</label>
            <label><input type="radio" name="turnMinutes" value="4"> 4</label>
            <label><input type="radio" name="turnMinutes" value="5" checked> 5</label>
          </div>
        </div>

      </div><!-- /settings-body-scroll -->

      <div style="display:flex; gap:12px; margin-top:20px; flex-wrap:wrap;">
        <button class="btn btn-secondary" id="closeSettingsBtn" style="flex:1;">Done</button>
      </div>
    </div>
  </div>

  <!-- ERROR MODAL (NEW!) -->
  <div class="error-overlay hidden" id="errorOverlay">
    <div class="error-modal">
      <div class="error-icon">âš ï¸</div>
      <div class="error-title" id="errorTitle">Error</div>
      <div class="error-message" id="errorMessage">Something went wrong</div>
      <div class="error-actions">
        <button class="btn btn-primary" id="errorRetryBtn">ğŸ”„ Retry</button>
        <button class="btn btn-secondary" id="errorCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- HELP MODAL (FIXED!) -->
  <div class="modal-overlay hidden" id="helpModal">
  <div class="modal" style="background:rgba(30,30,40,0.97); border-radius:16px; width:90%; max-width:600px; padding:0; overflow:hidden;">
    
    <!-- HEADER -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding:20px 24px; border-bottom:1px solid rgba(255,255,255,0.15);">
      <span style="color:#ffffff; font-size:20px; font-weight:700;">ğŸ’¡ Need Help?</span>
      <button id="helpClose" style="background:rgba(255,255,255,0.1); border:none; color:#fff; font-size:20px; width:36px; height:36px; border-radius:50%; cursor:pointer;">Ã—</button>
    </div>

    <!-- BODY -->
    <div style="padding:24px;">
      <p style="color:rgba(255,255,255,0.7); font-size:15px; margin-bottom:16px;">Stuck? Get AI-generated talking points to help you continue the debate!</p>
      <button class="btn btn-primary" id="getHelpBtn" style="width:100%; margin-bottom:16px;">âœ¨ Generate Talking Points</button>
      <div id="helpContent" style="color:#ffffff; font-size:16px; line-height:1.8; white-space:pre-wrap;"></div>
    </div>

  </div>
</div>



  <!-- TOAST -->
  <div class="toast" id="toast">
    <span id="toastMessage"></span>
  </div>

  <script type="module" src="/js/main.js"></script>
</body>
</html>